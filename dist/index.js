"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("algosdk"),t=function(e){return e.USE_PARENT_SIGNER="useParentSigner",e.ACCOUNT_ADDRESS="accountAddress",e.NETWORK="network",e.THEME_VARIABLES="themeVariables",e.PARENT_URL_ORIGIN="parentUrlOrigin",e.ASSET_IN="assetIn",e.ASSET_OUT="assetOut",e.PLATFORM_FEE_PERCENTAGE="platformFeePercentage",e.PLATFORM_FEE_ACCOUNT="platformFeeAccount",e.PLATFORM_NAME="platformName",e.SELECTABLE_ASSETS="selectableAssets",e}({}),n=function(e){return e.Light="light",e.Dark="dark",e}({}),r=function(e){return e.None="none",e.Small="small",e.Medium="medium",e.Large="large",e}({});function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(a=r.key,i=void 0,"symbol"==typeof(i=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(a,"string"))?i:String(i)),r)}var a,i}var i="https://tinymanorg.github.io/swap-widget/",s=new URL(i).origin,o=function(){return n=function e(t){var n=t.onTxnSignRequest,r=t.onTxnSignRequestTimeout,a=t.onSwapSuccess;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.messageListener=this.createWidgetEventListenerCallback({onTxnSignRequest:n,onTxnSignRequestTimeout:r,onSwapSuccess:a})},o=[{key:"sendMessageToWidget",value:function(e){var t=e.data,n=e.targetWindow;null==n||n.postMessage(t,s)}},{key:"generateWidgetIframeUrl",value:function(e){var n={},r=e.useParentSigner,a=e.assetIds,s=e.network,o=e.parentUrlOrigin,u=e.themeVariables,S=e.platformFeeAccount,c=e.platformFeePercentage,g=e.platformName,E=e.selectableAssets;if(n[t.PLATFORM_NAME]=g,r){var l=e.accountAddress;n[t.USE_PARENT_SIGNER]=String(r),l&&(n[t.ACCOUNT_ADDRESS]=l)}if(s&&(n[t.NETWORK]=s),u){var T=Buffer.from(JSON.stringify(u)).toString("base64");n[t.THEME_VARIABLES]=T}return o&&(n[t.PARENT_URL_ORIGIN]=Buffer.from(o).toString("base64")),a&&(n[t.ASSET_IN]=String(a[0]),n[t.ASSET_OUT]=String(a[1])),S&&(n[t.PLATFORM_FEE_ACCOUNT]=S),c&&(n[t.PLATFORM_FEE_PERCENTAGE]=String(c)),E&&(n[t.SELECTABLE_ASSETS]=E.join(",")),"".concat(i,"?").concat(new URLSearchParams(n))}}],(r=[{key:"createWidgetEventListenerCallback",value:function(t){var n=t.onTxnSignRequest,r=t.onTxnSignRequestTimeout,a=t.onSwapSuccess;return function(t){if(t.origin===s)switch(t.data.message.type){case"TXN_SIGN_REQUEST":var i=t.data.message.txGroups.map((function(t){return t.map((function(t){return{txn:e.decodeUnsignedTransaction(t.txn),signers:t.signers}}))}));n({txGroups:i});break;case"TXN_SIGN_REQUEST_TIMEOUT":r&&r();break;case"SWAP_SUCCESS":a&&a(t.data.message.response);break;default:throw new Error("Unknown message type")}}}},{key:"setWidgetEventListenerCallback",value:function(e){var t=e.onTxnSignRequest,n=e.onTxnSignRequestTimeout,r=e.onSwapSuccess;this.messageListener=this.createWidgetEventListenerCallback({onTxnSignRequest:t,onTxnSignRequestTimeout:n,onSwapSuccess:r})}},{key:"addWidgetEventListeners",value:function(){window.addEventListener("message",this.messageListener,!1)}},{key:"removeWidgetEventListeners",value:function(){window.removeEventListener("message",this.messageListener,!1)}}])&&a(n.prototype,r),o&&a(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}();exports.SwapWidgetAppTheme=n,exports.SwapWidgetBorderRadiusSize=r,exports.SwapWidgetSearchParamKey=t,exports.WidgetController=o;
